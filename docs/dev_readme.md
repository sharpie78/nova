# 🛠️ Nova Developer Guide  

## 🔀 Branch Structure  

- **main**: Production setup  
  - Clean repo for end users  
  - "Heavy" frontend files and AppImages are excluded from Git  
  - `setup.sh` downloads AppImages and models  

- **nova-dev**: Developer branch  
  - Full development branch  
  - Used for building/changing AppImages with Tauri and backend work  
  - Please always create sub-branches from `nova-dev` for new features/fixes

---

## 📁 UI Folder Structure  

```
frontend/
├── nova-editor/
│   ├── node_modules/       # Installed by npm (ignored by git)
│   ├── package.json        # Tauri project config (ignored by git)
│   ├── package-lock.json   # Dependency lock (ignored by git)
│   ├── README.md           # Local project readme (ignored by git)
│   ├── src/                # HTML/CSS/JS source (tracked)
│   └── src-tauri/          # Tauri project files (ignored by git)
├── nova-ui/
│   ├── node_modules/       # Installed by npm (ignored by git)
│   ├── package.json        # Tauri project config (ignored by git)
│   ├── package-lock.json   # Dependency lock (ignored by git)
│   ├── README.md           # Local project readme (ignored by git)
│   ├── src/                # HTML/CSS/JS source (tracked)
│   └── src-tauri/          # Tauri project files (ignored by git)
```  

On **main**, only the code in `/src` and built AppImages should be published — `node_modules/` and `src-tauri/` etc are stripped out.
There are some files needed for Tauri to work properly. They have been included in the repo for nova-dev branch.
If improvements or new features are added to the UI in your branch, please **build a new AppImage** as part of your development.  

---

- I'd prefer to be in charge of what gets updated for end users but...

If you want to merge `nova-dev` into `main` locally on your pc, add this alias to your shell config so the Editor/UI functions don’t get overwritten:

⚠️ **Important:** Never merge `nova-dev` into `main` without this alias — otherwise the Editor/UI launch functions will get overwritten, files not needed in main will get added and the ui's will break.

```bash
if ! grep -q "merge-dev-to-main" ~/.zshrc; then
  echo "alias merge-dev-to-main='git checkout main && git pull origin main && git merge --no-commit --no-ff nova-dev && git checkout --ours -- backend/servers/editor_router.py backend/tray/tray_ui.py frontend/nova-editor/src-tauri/capabilities/default.json frontend/nova-editor/src-tauri/tauri.conf.json frontend/nova-ui/src-tauri/capabilities/default.json frontend/nova-ui/src-tauri/tauri.conf.json && git add backend/servers/editor_router.py backend/tray/tray_ui.py frontend/nova-editor/src-tauri/capabilities/default.json frontend/nova-editor/src-tauri/tauri.conf.json frontend/nova-ui/src-tauri/capabilities/default.json frontend/nova-ui/src-tauri/tauri.conf.json && git commit -m \"Merge nova-dev into main (keep main editor/tray + tauri configs)\" && git push origin main'" >> ~/.zshrc
fi

source ~/.zshrc
```
- ### 🛑 Undo last merge (if something went wrong)

If the alias above was run and you need to roll back the last merge, run:

```bash
git reset --hard HEAD~1
git push origin main --force
```
or

```bash
if ! grep -q "merge-undo" ~/.zshrc; then
  echo "alias merge-undo='git reset --hard HEAD~1 && git push origin main --force'" >> ~/.zshrc
fi

source ~/.zshrc
```
and then run the alias

```bash
merge-undo
```

## ⚙️ Developer Setup  

1. Clone the repo into your home folder and checkout `nova-dev`, then run setup.sh:

```bash
git clone https://github.com/sharpie78/nova.git
cd nova
git checkout nova-dev
cd nova/setup
chmod +x setup.sh
sudo ./setup.sh
```  

2. Set up Tauri manually see [dev_tauri_setup.md](dev_tauri_setup.md)

...or...

run the tauri_setup.sh file in the setup folder.

```bash
cd $HOME/nova/setup
chmod +x tauri_setup.sh
./tauri_setup.sh
```

---

## 🚫 Git Ignore Strategy  

| File/Folder                    | Tracked? | Notes                       |
|--------------------------------|----------|-----------------------------|
| `frontend/nova-*/src/`          | ✅ Yes   | Always tracked              |
| `frontend/nova-*/src-tauri/`    | ❌ No    | Local only, dev branch      |
| `frontend/nova-*/node_modules/` | ❌ No    | Generated by npm            |
| `*.AppImage`                    | ❌ No    | Downloaded by setup         |
| `config/admin.settings.json`    | ❌ No    | User-specific config        |
| `config/users.json`             | ❌ No    | User-specific config        |  

👉 Also add your `<username>.settings.json` to `.gitignore`  

---

## 🔄 Merging `nova-dev` → `main`  

⚠️ **Please do not merge directly.**  
- All merges to `main` require approval — create a sub-branch of `nova-dev` and wait for review.  
- Approved merges should bring **src/** updates and new AppImages into `main` and the Releases section.  
- `node_modules/` and `src-tauri/` etc must not be merged.  
- Built AppImages should be uploaded to GitHub Releases. You are welcome to version them with any version suffix you wish.  

---

## 🧪 Tools & Scripts  

- `nova/setup/setup.sh` → Installs backend + downloads AppImages (available to all users)  
- `nova/setup/dev-tauri-setup.sh` → Prepares Tauri for dev (dev branch only)  
- `nova/setup/backup-frontend.sh` → Backup helper for frontend files (available to all users)  
- `nova/backend/utils/cuda_test.py` → Test CUDA/GPU availability (available to all users)  
- `nova/backend/utils/test_routes.py` → Quick check of backend API routes (available to all users)  

---

## 📎 Tips

- backup Tauri-related files before switching branches.
- Treat `nova-dev` as the main development workspace, and create new features/fixes in sub-branches.
- Keep `main` clean for end users.
- Document any ignored files here or in the main README.
