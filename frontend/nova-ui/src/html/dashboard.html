<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nova - Home</title>
  <link rel="icon" href="../assets/icons/novafavicon.png" type="image/png">
  <link rel="stylesheet" href="../css/styles-layout.css" />
  <link rel="stylesheet" href="../css/styles-layout-media.css" />
  <link rel="stylesheet" href="../css/styles-dark.css" />
  <link rel="stylesheet" href="../css/pages/modal-style.css" />
  <link rel="stylesheet" href="../css/pages/dashboard.css" />
</head>
<body class="dark">
  <div class="app-container">

    <!-- Sidebar -->
    <aside class="sidebar collapsed">
      <nav class="nav-sections">
        <div class="nav-top">
          <ul>
            <li><a href="dashboard.html"><span class="material-symbols-outlined">home</span><span class="label">Home</span></a></li>
            <li><a href="chat.html"><span class="material-symbols-outlined">chat</span><span class="label">Chat</span></a></li>
            <li><a href="voice.html"><span class="material-symbols-outlined">mic</span><span class="label">Voice Control</span></a></li>
            <li><a href="media.html"><span class="material-symbols-outlined">video_library</span><span class="label">Media</span></a></li>
            <li><a href="devices.html"><span class="material-symbols-outlined">devices</span><span class="label">Devices</span></a></li>
            <li><a href="to-do.html"><span class="material-symbols-outlined">checklist</span><span class="label">To-do</span></a></li>
            <li><a href="search.html"><span class="material-symbols-outlined">search</span><span class="label">Search</span></a></li>
            <li><a href="logs.html"><span class="material-symbols-outlined">receipt_long</span><span class="label">Logs</span></a></li>
          </ul>
        </div>
        <div class="nav-bottom">
          <ul>
            <li><a href="settings.html"><span class="material-symbols-outlined">settings</span><span class="label">Settings</span></a></li>
            <li><a href="notifications.html"><span class="material-symbols-outlined">notifications</span><span class="label">Notifications</span></a></li>
            <li><a href="profile.html"><span class="material-symbols-outlined">account_circle</span><span class="label">Profile</span></a></li>
          </ul>
        </div>
      </nav>
    </aside>

    <!-- Main content area -->
    <main>
      <!-- Top bar -->
      <header class="top-bar" data-tauri-drag-region>
        <div class="top-left">
          <h1>Dashboard</h1>
        </div>
        <div class="window-controls">
          <button id="titlebar-minimize" title="Minimize">‚àí</button>
          <button id="titlebar-maximize" title="Maximize">‚ñ°</button>
          <button id="titlebar-close" title="Close">√ó</button>
        </div>
      </header>


      <!-- Page content -->
      <section class="content dashboard">
        <!-- Welcome & Time -->
        <div class="dashboard-header">
          <h2 id="greeting"></h2>
          <p class="timestamp" id="time"></p>
        </div>

        <!-- Unified Dashboard Grid -->
        <div class="dashboard-grid">
          <div class="dashboard-card" data-modal-title="Voice Assistant" data-modal-content="Status: Disabled/Idle/Active">
            <h3>üé§ Voice Assistant</h3>
            <p><strong>Disabled/Idle/Active</strong></p>
          </div>

          <div class="dashboard-card" data-modal-title="AI Model Management" data-modal-content="">
            <h3>üß† AI Model Management</h3>
            <p><em style="font-size: 1.1rem; color: #aaa;">Currently selected model:</em></p>
            <p>
              <strong id="model-card-selected-model" style="opacity: 1; font-size: 1.2rem; color: #fff; font-weight: bold; background-color: #4caf50; padding: 6px 12px; border-radius: 4px; display: inline-block;">
              </strong>
            </p>
          </div>

          <div class="dashboard-card" data-modal-title="System Status" data-modal-content="">
            <h3>‚è± System Info</h3>
            <p><strong id="system-info"></strong></p>
          </div>

          <div class="dashboard-card" data-modal-title="Now Playing" data-modal-content='"Lo-fi Beats to Focus To"'>
            <h3>üé∂ Now Playing</h3>
            <p>"Lo-fi Beats to Focus To"</p>
          </div>

          <div class="dashboard-card" data-modal-title="To-do" data-modal-content='<ul><li>Feed the cat</li><li>Restart PC</li><li>Water plants</li></ul>'>
            <h3>üìã To-do</h3>
            <ul>
              <li><input type="checkbox" /> Feed the cat</li>
              <li><input type="checkbox" /> Restart PC</li>
              <li><input type="checkbox" /> Water plants</li>
            </ul>
          </div>

          <div class="dashboard-card" data-modal-title="Devices" data-modal-content='3 online ¬∑ 2 offline<br>Recent: Lamp turned off'>
            <h3>üí° Devices</h3>
            <p>3 online ¬∑ 2 offline</p>
            <p>Recent: Lamp turned off</p>
          </div>

          <div class="dashboard-card" data-modal-title="Logs" data-modal-content='No recent errors<br>Last: "Mic activated"'>
            <h3>ü™µ Logs</h3>
            <p>No recent errors</p>
            <p>Last: "Mic activated"</p>
          </div>

          <div class="dashboard-card" data-modal-title="Notifications" data-modal-content='Mic activated<br>Timer set for 20 min<br>Device "Lamp" turned off'>
            <h3>üîî Notifications</h3>
            <ul>
              <p>You have 3 new alerts</p>
            <ul>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Modal structure -->
  <div id="modal" class="modal hidden">
    <div class="modal-content">
      <button class="modal-close" aria-label="Close modal">&times;</button>
      <h2 id="modal-title"></h2>
      <div id="modal-body"></div>
    </div>
  </div>

  <!-- JavaScript -->
  <script src="../js/titlebar.js"></script>
  <script src="../js/sidebar.js"></script>
  <script src="../js/model-modal.js"></script>
  <script src="../js/system-modal.js"></script>
  <script src="../js/time-greeting.js"></script>
  <script type="module" src="../js/settings/settings-timeout.js"></script>

  <script>
    // Sidebar toggle function (deprecated ‚Äî safe to delete if unused)
    function toggleSidebar() {
        const sidebar = document.querySelector('.sidebar');
        sidebar.classList.toggle('collapsed');
    }
  </script>

  <script>
    // Function to check if the token is expired
    function isTokenExpired(token) {
        if (!token) return true;

        const decodedToken = JSON.parse(atob(token.split('.')[1]));
        const expirationTime = decodedToken.exp * 1000;
        const currentTime = Date.now();

        return currentTime >= expirationTime;
    }

    document.addEventListener("DOMContentLoaded", () => {
        const token = localStorage.getItem("jwtToken");

        if (!token || isTokenExpired(token)) {
            localStorage.removeItem("jwtToken");
        }

        const el = document.getElementById('model-card-selected-model');
        if (el) {
            el.textContent = localStorage.getItem('novaSelectedModel') || 'No model selected';
        }
    });
  </script>
</body>
</html>
